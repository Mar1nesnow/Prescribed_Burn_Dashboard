<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescribed Burn Weather Dashboard - Coon Rapids, IA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect } = React;

// Icon components
const Flame = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>;
const Wind = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>;
const Droplets = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>;
const Thermometer = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg>;
const Eye = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>;
const AlertTriangle = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>;

const PrescribedBurnDashboard = () => {
  const [weatherData, setWeatherData] = useState(null);
  const [forecast, setForecast] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const LAT = 41.8711;
  const LON = -94.6778;

  useEffect(() => {
    fetchWeatherData();
  }, []);

  const fetchWeatherData = async () => {
    try {
      setLoading(true);
      setError(null);
      
      const pointResponse = await fetch(
        `https://api.weather.gov/points/${LAT},${LON}`,
        {
          headers: {
            'User-Agent': 'PrescribedBurnDashboard/1.0',
            'Accept': 'application/geo+json'
          }
        }
      );
      
      if (!pointResponse.ok) {
        throw new Error('Unable to connect to weather service. Status: ' + pointResponse.status);
      }
      
      const pointData = await pointResponse.json();
      
      const stationsResponse = await fetch(pointData.properties.observationStations, {
        headers: {
          'User-Agent': 'PrescribedBurnDashboard/1.0',
          'Accept': 'application/geo+json'
        }
      });
      const stationsData = await stationsResponse.json();
      
      if (!stationsData.features || stationsData.features.length === 0) {
        throw new Error('No weather stations found near this location');
      }
      
      const nearestStation = stationsData.features[0].id;
      
      const obsResponse = await fetch(`${nearestStation}/observations/latest`, {
        headers: {
          'User-Agent': 'PrescribedBurnDashboard/1.0',
          'Accept': 'application/geo+json'
        }
      });
      
      if (!obsResponse.ok) {
        throw new Error('Unable to get current observations');
      }
      
      const obsData = await obsResponse.json();
      
      const forecastResponse = await fetch(pointData.properties.forecastHourly, {
        headers: {
          'User-Agent': 'PrescribedBurnDashboard/1.0',
          'Accept': 'application/geo+json'
        }
      });
      
      if (!forecastResponse.ok) {
        throw new Error('Unable to get forecast data');
      }
      
      const forecastData = await forecastResponse.json();
      
      setWeatherData(obsData.properties);
      setForecast(forecastData.properties.periods);
      setLoading(false);
    } catch (err) {
      console.error('Weather fetch error:', err);
      setError('Failed to fetch weather data: ' + err.message);
      setLoading(false);
    }
  };

  const celsiusToFahrenheit = (celsius) => {
    if (celsius === null) return null;
    return (celsius * 9/5) + 32;
  };

  const metersPerSecondToMph = (mps) => {
    if (mps === null) return null;
    return mps * 2.237;
  };

  const calculateBurnConditions = () => {
    if (!weatherData) return { status: 'unknown', color: 'bg-gray-500', message: 'Loading...' };
    
    const temp = celsiusToFahrenheit(weatherData.temperature.value);
    const humidity = weatherData.relativeHumidity.value;
    const windSpeed = metersPerSecondToMph(weatherData.windSpeed.value);
    
    if (!temp || !humidity || !windSpeed) {
      return { status: 'unknown', color: 'bg-gray-500', message: 'Waiting for data...', issues: [] };
    }
    
    let score = 0;
    let issues = [];
    
    if (temp >= 45 && temp <= 65) score += 33;
    else if (temp < 35 || temp > 75) issues.push('Temperature out of ideal range');
    
    if (humidity >= 25 && humidity <= 55) score += 33;
    else if (humidity < 20) issues.push('Humidity too low (increased fire risk)');
    else if (humidity > 60) issues.push('Humidity too high (may affect ignition)');
    
    if (windSpeed >= 5 && windSpeed <= 15) score += 34;
    else if (windSpeed < 3) issues.push('Wind too calm (smoke dispersal issues)');
    else if (windSpeed > 20) issues.push('Wind too strong (control risk)');
    
    if (score >= 80) {
      return { status: 'Excellent', color: 'bg-green-500', message: 'Ideal conditions for prescribed burn', issues };
    } else if (score >= 50) {
      return { status: 'Acceptable', color: 'bg-yellow-500', message: 'Conditions acceptable with caution', issues };
    } else {
      return { status: 'Poor', color: 'bg-red-500', message: 'Conditions not recommended', issues };
    }
  };

  const getWindDirection = (degrees) => {
    if (!degrees) return 'N/A';
    const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
    return directions[Math.round(degrees / 22.5) % 16];
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-100 p-8 flex items-center justify-center">
        <div className="text-xl text-gray-700">Loading weather data for Coon Rapids, IA...</div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-100 p-8">
        <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-8">
          <div className="text-red-600 text-lg mb-4">Unable to load weather data</div>
          <p className="text-gray-600 mb-4">Error: {error}</p>
          <button 
            onClick={fetchWeatherData}
            className="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600"
          >
            Retry
          </button>
        </div>
      </div>
    );
  }

  const conditions = calculateBurnConditions();
  const temp = weatherData.temperature.value ? celsiusToFahrenheit(weatherData.temperature.value) : null;
  const humidity = weatherData.relativeHumidity.value;
  const windSpeed = weatherData.windSpeed.value ? metersPerSecondToMph(weatherData.windSpeed.value) : null;
  const windDirection = weatherData.windDirection.value;
  const visibility = weatherData.visibility.value ? (weatherData.visibility.value / 1609.34) : null;

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        <header className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <Flame className="w-8 h-8 text-orange-600" />
            <h1 className="text-3xl font-bold text-gray-800">Prescribed Burn Weather Dashboard</h1>
          </div>
          <p className="text-gray-600">Coon Rapids, Iowa • Last updated: {new Date(weatherData.timestamp).toLocaleString()}</p>
        </header>

        <div className={`${conditions.color} text-white rounded-lg p-6 mb-6 shadow-lg`}>
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold mb-2">Burn Conditions: {conditions.status}</h2>
              <p className="text-lg">{conditions.message}</p>
              {conditions.issues && conditions.issues.length > 0 && (
                <div className="mt-3">
                  <p className="font-semibold mb-1">Considerations:</p>
                  <ul className="list-disc ml-5">
                    {conditions.issues.map((issue, idx) => (
                      <li key={idx}>{issue}</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
            <AlertTriangle className="w-16 h-16 opacity-80" />
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div className="bg-white rounded-lg p-6 shadow-md">
            <div className="flex items-center gap-3 mb-2">
              <Thermometer className="w-6 h-6 text-red-500" />
              <h3 className="font-semibold text-gray-700">Temperature</h3>
            </div>
            <p className="text-3xl font-bold text-gray-800">
              {temp ? `${Math.round(temp)}°F` : 'N/A'}
            </p>
            <p className="text-sm text-gray-500 mt-1">
              Dew point: {weatherData.dewpoint.value ? `${Math.round(celsiusToFahrenheit(weatherData.dewpoint.value))}°F` : 'N/A'}
            </p>
            <p className="text-xs text-gray-400 mt-2">Ideal: 45-65°F</p>
          </div>

          <div className="bg-white rounded-lg p-6 shadow-md">
            <div className="flex items-center gap-3 mb-2">
              <Droplets className="w-6 h-6 text-blue-500" />
              <h3 className="font-semibold text-gray-700">Humidity</h3>
            </div>
            <p className="text-3xl font-bold text-gray-800">
              {humidity ? `${Math.round(humidity)}%` : 'N/A'}
            </p>
            <p className="text-sm text-gray-500 mt-1">
              Pressure: {weatherData.barometricPressure.value ? `${(weatherData.barometricPressure.value / 100).toFixed(1)} mb` : 'N/A'}
            </p>
            <p className="text-xs text-gray-400 mt-2">Ideal: 25-55%</p>
          </div>

          <div className="bg-white rounded-lg p-6 shadow-md">
            <div className="flex items-center gap-3 mb-2">
              <Wind className="w-6 h-6 text-teal-500" />
              <h3 className="font-semibold text-gray-700">Wind</h3>
            </div>
            <p className="text-3xl font-bold text-gray-800">
              {windSpeed ? `${Math.round(windSpeed)} mph` : 'N/A'}
            </p>
            <p className="text-sm text-gray-500 mt-1">
              Direction: {getWindDirection(windDirection)} ({windDirection ? `${Math.round(windDirection)}°` : 'N/A'})
            </p>
            <p className="text-xs text-gray-400 mt-2">Ideal: 5-15 mph</p>
          </div>

          <div className="bg-white rounded-lg p-6 shadow-md">
            <div className="flex items-center gap-3 mb-2">
              <Eye className="w-6 h-6 text-purple-500" />
              <h3 className="font-semibold text-gray-700">Visibility</h3>
            </div>
            <p className="text-3xl font-bold text-gray-800">
              {visibility ? `${visibility.toFixed(1)} mi` : 'N/A'}
            </p>
            <p className="text-sm text-gray-500 mt-1">
              {weatherData.textDescription || 'Clear'}
            </p>
            <p className="text-xs text-gray-400 mt-2">
              Cloud cover: {weatherData.cloudLayers && weatherData.cloudLayers.length > 0 ? weatherData.cloudLayers[0].amount : 'Clear'}
            </p>
          </div>
        </div>

        {forecast && forecast.length > 0 && (
          <div className="bg-white rounded-lg p-6 shadow-md">
            <h3 className="text-xl font-bold text-gray-800 mb-4">12-Hour Forecast</h3>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
              {forecast.slice(0, 6).map((period, idx) => {
                const time = new Date(period.startTime);
                return (
                  <div key={idx} className="border border-gray-200 rounded p-3">
                    <p className="text-sm font-semibold text-gray-700">
                      {time.toLocaleTimeString([], {hour: 'numeric'})}
                    </p>
                    <p className="text-2xl font-bold text-gray-800 mt-1">{period.temperature}°</p>
                    <div className="flex items-center gap-1 mt-2 text-sm text-gray-600">
                      <Droplets className="w-4 h-4" />
                      <span>{period.relativeHumidity.value}%</span>
                    </div>
                    <div className="flex items-center gap-1 mt-1 text-sm text-gray-600">
                      <Wind className="w-4 h-4" />
                      <span>{period.windSpeed}</span>
                    </div>
                    <p className="text-xs text-gray-500 mt-2">{period.shortForecast}</p>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mt-6 rounded">
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" />
            <div className="text-sm text-gray-700">
              <p className="font-semibold mb-1">Safety Reminder</p>
              <p>Always consult with local fire authorities and obtain proper permits before conducting a prescribed burn. Weather conditions can change rapidly. Monitor conditions continuously during burn operations.</p>
            </div>
          </div>
        </div>

        <button 
          onClick={fetchWeatherData}
          className="mt-4 bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600 transition-colors"
        >
          Refresh Data
        </button>
      </div>
    </div>
  );
};

ReactDOM.render(<PrescribedBurnDashboard />, document.getElementById('root'));
    </script>
</body>
</html>
